function addPriceLine(a,x,an,v){var N=jQuery.noConflict();var ak=pricingidx;var n=N('<tr id="row-'+ak+'"></tr>');if(v=="after"){n.insertAfter(a)}else{if(v=="before"){n.insertBefore(a)}else{n.appendTo(a)}}var V=N('<th class="pricing-label"></th>').appendTo(n);var ae=N('<label for="label['+ak+']"></label>').appendTo(V);var ad=N('<input type="hidden" name="price['+ak+'][label]" id="label['+ak+']" />').appendTo(V);ad.change(function(){ae.text(N(this).val())});var s=N('<input type="hidden" name="price['+ak+'][id]" id="id['+ak+']" />').appendTo(V);var q=N('<input type="hidden" name="price['+ak+'][product]" id="product['+ak+']" />').appendTo(V);var ap=N('<input type="hidden" name="price['+ak+'][context]" />').appendTo(V);var R=N('<input type="hidden" name="price['+ak+'][optionkey]" class="optionkey" />').appendTo(V);var l=N('<input type="hidden" name="price['+ak+'][options]" />').appendTo(V);var C=N('<input type="hidden" name="sortorder[]" value="'+ak+'" />').appendTo(V);var ac=N("<td/>").appendTo(n);var am=N("<table/>").addClass("pricing-table").appendTo(ac);var O=N("<tr/>").appendTo(am);var y=N("<tr/>").appendTo(am);var b=N('<th><label for="type-'+ak+'">'+TYPE_LABEL+"</label></th>").appendTo(O);var ao=N("<td/>").appendTo(y);var aa="";N(priceTypes).each(function(i,av){aa+='<option value="'+av.value+'">'+av.label+"</option>"});var at=N('<select name="price['+ak+'][type]" id="type-'+ak+'" tabindex="'+(ak+1)+'02"></select>').html(aa).appendTo(ao);var S=N("<th/>").appendTo(O);var au=N('<label for="price['+ak+']">'+PRICE_LABEL+"</label>").appendTo(S);var ab=N("<td/>").appendTo(y);var M=N('<input type="text" name="price['+ak+'][price]" id="price['+ak+']" value="0" size="10" class="selectall right" tabindex="'+(ak+1)+'03" />').appendTo(ab);N("<br />").appendTo(ab);N('<input type="hidden" name="price['+ak+'][tax]" tabindex="'+(ak+1)+'04" value="on" />').appendTo(ab);var P=N('<input type="checkbox" name="price['+ak+'][tax]" id="tax['+ak+']" tabindex="'+(ak+1)+'04" value="off" />').appendTo(ab);var af=N('<label for="tax['+ak+']"> '+NOTAX_LABEL+"</label><br />").appendTo(ab);var d=N('<th><label for="sale['+ak+']"> '+SALE_PRICE_LABEL+"</label></th>").appendTo(O);var D=N('<input type="checkbox" name="price['+ak+'][sale]" id="sale['+ak+']" tabindex="'+(ak+1)+'05" />').prependTo(d);N('<input type="hidden" name="price['+ak+'][sale]" value="off" />').prependTo(d);var Y=N("<td/>").appendTo(y);var H=N("<span>"+NOT_ON_SALE_TEXT+"</span>").addClass("status").appendTo(Y);var z=N("<span/>").addClass("fields").appendTo(Y).hide();var G=N('<input type="text" name="price['+ak+'][saleprice]" id="saleprice['+ak+']" size="10" class="selectall right" tabindex="'+(ak+1)+'06" />').appendTo(z);var B=N("<th/>").appendTo(O);var w=N('<td width="58%" />').appendTo(y);N('<input type="hidden" name="price['+ak+'][donation][var]" value="off" />').appendTo(w);var L=N('<input type="checkbox" name="price['+ak+'][donation][var]" id="donation-var['+ak+']" tabindex="'+(ak+1)+'05" value="on" />').appendTo(w);N('<label for="donation-var['+ak+']"> '+DONATIONS_VAR_LABEL+"</label><br />").appendTo(w);N('<input type="hidden" name="price['+ak+'][donation][min]" value="off" />').appendTo(w);var c=N('<input type="checkbox" name="price['+ak+'][donation][min]" id="donation-min['+ak+']" tabindex="'+(ak+1)+'06" value="on" />').appendTo(w);N('<label for="donation-min['+ak+']"> '+DONATIONS_MIN_LABEL+"</label>").appendTo(w);var u=N('<th><label for="shipping-'+ak+'"> '+SHIPPING_LABEL+"</label></th>").appendTo(O);var g=N('<input type="checkbox" name="price['+ak+'][shipping]" id="shipping-'+ak+'" tabindex="'+(ak+1)+'07" />').prependTo(u);N('<input type="hidden" name="price['+ak+'][shipping]" value="off" />').prependTo(u);var al=N("<td/>").appendTo(y);var h=N("<span>"+FREE_SHIPPING_TEXT+"</span>").addClass("status").appendTo(al);var K=N("<span/>").addClass("fields").appendTo(al).hide();var X=N('<input type="text" name="price['+ak+'][weight]" id="weight['+ak+']" size="8" class="selectall right" tabindex="'+(ak+1)+'08" />').appendTo(K);var t=N('<label for="weight['+ak+']" title="Weight"> '+WEIGHT_LABEL+((weightUnit)?" ("+weightUnit+")":"")+"</label><br />").appendTo(K);var f=N('<input type="text" name="price['+ak+'][shipfee]" id="shipfee['+ak+']" size="8" class="selectall right" tabindex="'+(ak+1)+'08" />').appendTo(K);var E=N('<label for="shipfee['+ak+']" title="Additional shipping fee calculated per quantity ordered (for handling costs, etc)"> '+SHIPFEE_LABEL+"</label><br />").appendTo(K);var T=N('<th><label for="inventory['+ak+']"> '+INVENTORY_LABEL+"</label></th>").appendTo(O);var k=N('<input type="checkbox" name="price['+ak+'][inventory]" id="inventory['+ak+']" tabindex="'+(ak+1)+'10" />').prependTo(T);N('<input type="hidden" name="price['+ak+'][inventory]" value="off" />').prependTo(d);var U=N("<td/>").appendTo(y);var m=N("<span>"+NOT_TRACKED_TEXT+"</span>").addClass("status").appendTo(U);var ar=N("<span/>").addClass("fields").appendTo(U).hide();var ah=N('<input type="text" name="price['+ak+'][stock]" id="stock['+ak+']" size="8" class="selectall right" tabindex="'+(ak+1)+'11" />').appendTo(ar);var J=N('<label for="stock['+ak+']"> '+IN_STOCK_LABEL+"</label>").appendTo(ar);var Q=N("<br/>").appendTo(ar);var A=N('<input type="text" name="price['+ak+'][sku]" id="sku['+ak+']" size="8" title="Enter a unique tracking number for this product option." class="selectall" tabindex="'+(ak+1)+'12" />').appendTo(ar);var j=N('<label for="sku['+ak+']" title="'+SKU_LABEL_HELP+'"> '+SKU_LABEL+"</label>").appendTo(ar);var ag=N('<th><label for="download['+ak+']">Product Download</label></th>').appendTo(O);var W=N('<td width="31%" />').appendTo(y);var I=N("<div></div>").html("No product download.").appendTo(W);var p=N('<td rowspan="2" class="controls" width="75" />').appendTo(O);if(storage=="fs"){var F=N("<div></div>").prependTo(W).hide();var aq=N('<input type="text" name="price['+ak+'][downloadpath]" value="" title="Enter file path relative to: '+productspath+'" class="filepath" />').appendTo(F).change(function(){N(this).removeClass("warning").addClass("verifying");N.ajax({url:fileverify_url+"&action=wp_ajax_shopp_verify_file",type:"POST",data:"filepath="+N(this).val(),timeout:10000,dataType:"text",success:function(i){aq.removeClass("verifying");if(i=="OK"){return}if(i=="NULL"){aq.addClass("warning").attr("title",FILE_NOT_FOUND_TEXT)}if(i=="ISDIR"){aq.addClass("warning").attr("title",FILE_ISDIR_TEXT)}if(i=="READ"){aq.addClass("warning").attr("title",FILE_NOT_READ_TEXT)}}})});var r=N('<button type="button" class="button-secondary" tabindex="'+(ak+1)+'14"><small>By File Path</small></button>').appendTo(p).click(function(){F.slideToggle()})}var aj=N('<div id="flash-product-uploader-'+ak+'"></div>').appendTo(p);var o=N('<button type="button" class="button-secondary" tabindex="'+(ak+1)+'13"><small>'+UPLOAD_FILE_BUTTON_TEXT+"</small></button>").appendTo(p);var ai=new FileUploader(N(aj).attr("id"),o,ak,I);var Z=new Object();Z.id=pricingidx;Z.options=x;Z.data=an;Z.row=n;Z.rowid=0;Z.label=ad;Z.links=new Array();Z.inputs=new Array(at,M,P,D,G,L,c,g,X,f,k,ah,A);Z.disable=function(){at.val("N/A").trigger("change.value")};Z.updateKey=function(){R.val(xorkey(this.options))};Z.updateLabel=function(){var i="";var av="";if(this.options){N(this.options).each(function(aw,ax){if(i==""){i=N(productOptions[ax]).val()}else{i+=", "+N(productOptions[ax]).val()}if(av==""){av=ax}else{av+=","+ax}})}if(i==""){i=DEFAULT_PRICELINE_LABEL}this.label.val(htmlentities(i)).change();l.val(av)};Z.updateTabindex=function(i){N.each(this.inputs,function(aw,av){N(av).attr("tabindex",((i+1)*100)+aw)})};Z.linkInputs=function(i){Z.links.push(i);N.each(Z.inputs,function(aw,av){if(!av){return}var ax="change.linkedinputs";if(N(av).attr("type")=="checkbox"){ax="click.linkedinputs"}N(av).bind(ax,function(){var az=N(this).val();var ay=N(this).attr("checked");N.each(Z.links,function(aA,aB){N.each(linkedPricing[aB],function(aD,aC){if(aC==xorkey(Z.options)){return}if(!pricingOptions[aC]){return}if(N(av).attr("type")=="checkbox"){N(pricingOptions[aC].inputs[aw]).attr("checked",ay)}else{N(pricingOptions[aC].inputs[aw]).val(az)}N(pricingOptions[aC].inputs[aw]).trigger("change.value")})})})})};Z.unlinkInputs=function(i){if(i!==false){index=N.inArray(i,Z.links);Z.links.splice(index,1)}N.each(Z.inputs,function(aw,av){if(!av){return}var ax="blur.linkedinputs";if(N(av).attr("type")=="checkbox"){ax="click.linkedinputs"}N(av).unbind(ax)})};Z.updateKey();Z.updateLabel();var e=new Object();e.All=new Array(S,ab,d,Y,u,al,T,U,ag,W,p,B,w);if(pricesPayload){e.Shipped=new Array(S,ab,d,Y,u,al,T,U);e.Virtual=new Array(S,ab,d,Y,T,U);e.Download=new Array(S,ab,d,Y,ag,W,p)}else{e.Shipped=new Array(S,ab,u,al);e.Virtual=new Array(S,ab);e.Download=new Array(S,ab)}e.Donation=new Array(S,ab,B,w);at.bind("change.value",function(){var i=at.val();for(var av in e.All){N(e.All[av]).hide()}au.html(PRICE_LABEL);if(e[i]){for(var av in e[i]){N(e[i][av]).show()}}if(at.val()=="Donation"){au.html(AMOUNT_LABEL);P.attr("checked","true").change()}});D.bind("change.value",function(){if(this.checked){H.hide();z.show()}else{H.show();z.hide()}if(N.browser.msie){N(this).blur()}}).click(function(){if(N.browser.msie){N(this).trigger("change.value")}if(this.checked){G.focus().select()}});g.bind("change.value",function(){if(this.checked){h.hide();K.show()}else{h.show();K.hide()}if(N.browser.msie){N(this).blur()}}).click(function(){if(N.browser.msie){N(this).trigger("change.value")}if(this.checked){X.focus().select()}});k.bind("change.value",function(){if(this.checked){m.hide();ar.show()}else{m.show();ar.hide()}if(N.browser.msie){N(this).blur()}}).click(function(){if(N.browser.msie){N(this).trigger("change.value")}if(this.checked){ah.focus().select()}});M.bind("change.value",function(){this.value=asMoney(this.value)}).trigger("change.value");G.bind("change.value",function(){this.value=asMoney(this.value)}).trigger("change.value");f.bind("change.value",function(){this.value=asMoney(this.value)}).trigger("change.value");X.bind("change.value",function(){var i=new Number(this.value);this.value=i.roundFixed(3)}).trigger("change.value");if(an&&an.context){ap.val(an.context)}else{ap.val("product")}if(an&&an.label){ad.val(htmlentities(an.label)).change();at.val(an.type);s.val(an.id);q.val(an.product);A.val(an.sku);M.val(asMoney(an.price));if(an.sale=="on"){D.attr("checked","true").trigger("change.value")}if(an.shipping=="on"){g.attr("checked","true").trigger("change.value")}if(an.inventory=="on"){k.attr("checked","true").trigger("change.value")}if(an.donation){if(an.donation["var"]=="on"){L.attr("checked",true)}if(an.donation.min=="on"){c.attr("checked",true)}}G.val(asMoney(an.saleprice));f.val(asMoney(an.shipfee));X.val(an.weight).trigger("change.value");ah.val(an.stock);if(an.download){if(an.filedata.mimetype){an.filedata.mimetype=an.filedata.mimetype.replace(/\//gi," ")}I.attr("class","file "+an.filedata.mimetype).html(an.filename+"<br /><small>"+readableFileSize(an.filesize)+"</small>").click(function(){window.location.href=adminurl+"admin.php?page=shopp-lookup&download="+an.download})}if(an.tax=="off"){P.attr("checked","true")}}else{if(at.val()=="Shipped"){g.attr("checked","true").trigger("change.value")}}quickSelects(n);at.change();if(x){pricingOptions[xorkey(x)]=Z}N("#prices").val(pricingidx++);return n};