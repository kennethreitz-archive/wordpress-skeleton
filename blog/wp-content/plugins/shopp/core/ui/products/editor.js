var productOptions=new Array();var optionMenus=new Array();var pricingOptions=new Object();var linkedPricing=new Array();var selectedMenuOption=false;var detailsidx=1;var variationsidx=1;var optionsidx=1;var pricingidx=1;var fileUploader=false;var changes=false;var saving=false;var flashUploader=false;var pricesPayload=true;jQuery(document).ready(function(){var c=jQuery.noConflict();if(!wp26){postboxes.add_postbox_toggles("admin_page_shopp-products-edit");jQuery(".if-js-closed").removeClass("if-js-closed").addClass("closed")}if(!product){c("#title").focus()}var b=new SlugEditor(product,"product");if(specs){c.each(specs,function(){addDetail(this)})}c("#addDetail").click(function(){addDetail()});var a=c(prices).get(0);if(a&&a.context=="product"){addPriceLine("#product-pricing",[],a)}else{addPriceLine("#product-pricing",[])}c("#variations-setting").click(variationsToggle);variationsToggle();loadVariations(options,prices);c("#addVariationMenu").click(function(){addVariationOptionsMenu()});c("#linkOptionVariations").click(linkVariationsButton);c("#linkOptionVariations").change(linkVariationsButtonLabel);categories();tags();quickSelects();updateWorkflow();imageUploads=new ImageUploads(c("#image-product-id").val(),"product");window.onbeforeunload=unsavedChanges;c("#product").change(function(){changes=true}).submit(function(){this.action=this.action+"?"+c.param(request);saving=true;return true})});function updateWorkflow(){var a=jQuery.noConflict();a("#workflow").change(function(){setting=a(this).val();request.page=workflow[setting];request.id=product;if(!request.id){request.id="new"}if(setting=="new"){request.next=setting}if(setting=="previous"){a.each(worklist,function(b,c){if(c.id==product){if(worklist[b-1]){request.next=worklist[b-1].id}else{request.page=workflow.close}return true}})}if(setting=="next"){a.each(worklist,function(b,c){if(c.id==product){if(worklist[b+1]){request.next=worklist[b+1].id}else{request.page=workflow.close}return true}})}}).change()}function categories(){var b=jQuery.noConflict();b("#new-category input, #new-category select").hide();b("#add-new-category").click(function(){b("#new-category input, #new-category select").toggle();b("#new-category input").focus();var c=b("#new-category input").val();var d=b("#new-category select").val();if(c!=""){b(this).addClass("updating");b.getJSON(addcategory_url+"&action=wp_ajax_shopp_add_category&name="+c+"&parent="+d,function(e){b("#add-new-category").removeClass("updating");a(e);b.get(siteurl+"/wp-admin/admin.php?lookup=category-menu",false,function(g){var f=b("#new-category select option").eq(0).clone();b("#new-category select").empty().html(g);f.prependTo("#new-category select");b("#new-category select").attr("selectedIndex",0)},"html");b("#new-category input").val("")})}});b("#category-menu input.category-toggle").change(function(){if(!this.checked){return true}var c=new Array();b("#details-menu").children().children().find("input.label").each(function(f,e){c.push(b(e).val())});var d=b(this).attr("id").substr(b(this).attr("id").indexOf("-")+1);b.getJSON(siteurl+"/wp-admin/admin.php?lookup=spectemplate&cat="+d,function(e){if(!e){return true}for(d in e){e[d].add=true;if(c.toString().search(e[d]["name"])==-1){addDetail(e[d])}}});b.getJSON(siteurl+"/wp-admin/admin.php?lookup=optionstemplate&cat="+d,function(e){if(!e){return true}if(!e.options){return true}if(!b("#variations-setting").attr("checked")){b("#variations-setting").click();variationsToggle()}if(optionMenus.length>0){b.each(e.options,function(h,f){if(menu=optionMenuExists(f.name)){var g=false;b.each(f.options,function(j,k){if(!optionMenuItemExists(menu,k.name)){menu.addOption(k);g=true}});if(g){addVariationPrices()}}else{addVariationOptionsMenu(f);addVariationPrices()}})}else{loadVariations(e.options,e.prices)}})});function a(k){var g=jQuery.noConflict();var m=false;var d=g("#new-category input").val();var e=g("#new-category select").val();if(e>0){if(g("#category-element-"+e+" ~ li > ul").size()>0){m=g("#category-element-"+e+" ~ li > ul")}else{var i=g("#category-element-"+e);var f=g("<li></li>").insertAfter(i);m=g("<ul></ul>").appendTo(f)}}else{m=g("#category-menu > ul")}var j=false;m.children().each(function(){var c=g(this).children("label").text();if(c&&d<c){j=this;return false}});if(!j){var n=g('<li id="category-element-'+k.id+'"></li>').appendTo(m)}else{var n=g('<li id="category-element-'+k.id+'"></li>').insertBefore(j)}var h=g('<input type="checkbox" name="categories[]" value="'+k.id+'" id="category-'+k.id+'" checked="checked" />').appendTo(n);var l=g('<label for="category-'+k.id+'"></label>').html(d).appendTo(n)}}function tags(){var a=jQuery.noConflict();function b(){a("#tagchecklist").empty();var c=a("#tags").val().split(",");if(c[0].length>0){a(c).each(function(g,d){var e=a("<span></span>").html(d).appendTo("#tagchecklist");var f=a("<a></a>").html("X").addClass("ntdelbutton").prependTo(e);f.click(function(){var h=a("#tags").val();h=h.replace(new RegExp("(^"+d+",?|,"+d+"\\b)"),"");a("#tags").val(h);b()})})}}a("#newtags").focus(function(){if(a(this).val()==a(this).attr("title")){a(this).val("").toggleClass("form-input-tip")}});a("#newtags").blur(function(){if(a(this).val()==""){a(this).val(a(this).attr("title")).toggleClass("form-input-tip")}});a("#add-tags").click(function(){if(a("#newtags").val()==a("#newtags").attr("title")){return true}newtags=a("#newtags").val().split(",");a(newtags).each(function(e,c){var d=a("#tags").val();c=a.trim(c);if(d==""){a("#tags").val(c)}else{if(d!=c&&d.indexOf(c+",")==-1&&d.indexOf(","+c)==-1){a("#tags").val(d+","+c)}}});b();a("#newtags").val("").blur()});b()};